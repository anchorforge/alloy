# NOTE: replace directives below must always be *temporary*.
#
# Adding a replace directive to change a module to a fork of a module will
# only be accepted when a PR upstream has been opened to accept the new
# change.
#
# Contributors are expected to work with upstream to make their changes
# acceptable, and remove the `replace` directive as soon as possible.
#
# If upstream is unresponsive, you should consider making a hard fork
# (i.e., creating a new Go module with the same source) or picking a different
# dependency.

# Modules define the target files where replaces will be applied.
# Each module specifies:
#   - name: identifier for the module (used as scope in replaces)
#   - path: path from project root to the dependency file
#   - file_type: "mod" for go.mod files, "yaml" for YAML files
#   - output_file: name of the generated replaces file (relative to tool directory)
modules:
  - name: alloy
    path: go.mod
    file_type: mod
    output_file: alloy-mod-replaces.txt
  - name: extension
    path: extension/alloyengine/go.mod
    file_type: mod
    output_file: extension-mod-replaces.txt
  - name: syntax
    path: syntax/go.mod
    file_type: mod
    output_file: syntax-go-mod-replaces.txt
  - name: collector
    path: collector/builder-config.yaml
    file_type: ocb
    output_file: ocb-replaces.txt

replaces:
  # Local module replacements for alloyengine
  - comment: Local submodule replace
    dependency: github.com/grafana/alloy/extension/alloyengine
    replacement: ../extension/alloyengine
    scope:
      - collector

  # Local module replacements for alloy
  - comment: Local submodule replace
    dependency: github.com/grafana/alloy
    replacement: ../
    scope:
      - collector

  - comment: Local submodule replace
    dependency: github.com/grafana/alloy
    replacement: ../../
    scope:
      - extension

  - comment: Local submodule replace
    dependency: github.com/grafana/alloy/syntax
    replacement: ../syntax
    scope:
      - collector

  - comment: Local submodule replace
    dependency: github.com/grafana/alloy/syntax
    replacement: ../../syntax
    scope:
      - extension

  - comment: >
      TODO: remove this replace directive once the upstream issue is fixed:
      https://github.com/prometheus/prometheus/issues/13842
    dependency: go.opentelemetry.io/collector/featuregate
    replacement: github.com/grafana/opentelemetry-collector/featuregate v0.0.0-20240325174506-2fd1623b2ca0
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Replace directives from Prometheus
    dependency: github.com/fsnotify/fsnotify v1.8.0
    replacement: github.com/fsnotify/fsnotify v1.7.0
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      TODO: remove replace directive once there is a release of Prometheus
      which addresses https://github.com/prometheus/prometheus/issues/14049,
      for example, via this implementation: https://github.com/grafana/prometheus/pull/34
    dependency: github.com/prometheus/prometheus
    replacement: github.com/grafana/prometheus v1.8.2-0.20251030104821-c9e0b31e9aeb
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Replace yaml.v2 with fork
    dependency: gopkg.in/yaml.v2
    replacement: github.com/rfratto/go-yaml v0.0.0-20211119180816-77389c3526dc
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Replace directives from Loki — Azure SDK
    dependency: github.com/Azure/azure-sdk-for-go
    replacement: github.com/Azure/azure-sdk-for-go v68.0.0+incompatible
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Replace directives from Loki — Azure storage blob fork
    dependency: github.com/Azure/azure-storage-blob-go
    replacement: github.com/MasslessParticle/azure-storage-blob-go v0.14.1-0.20240322194317-344980fda573
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Use fork of gocql that has gokit logs and Prometheus metrics
    dependency: github.com/gocql/gocql
    replacement: github.com/grafana/gocql v0.0.0-20200605141915-ba5dc39ece85
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Insist on the optimised version of grafana/regexp
    dependency: github.com/grafana/regexp
    replacement: github.com/grafana/regexp v0.0.0-20240518133315-a468a5bfb3bc
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      Replace memberlist with Grafana fork which includes unmerged upstream fixes
    dependency: github.com/hashicorp/memberlist
    replacement: github.com/grafana/memberlist v0.3.1-0.20220714140823-09ffed8adbbe
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      Use forked syslog implementation by leodido for continued support
    dependency: github.com/influxdata/go-syslog/v3
    replacement: github.com/leodido/go-syslog/v4 v4.2.0
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Replace thanos-io/objstore with Grafana fork
    dependency: github.com/thanos-io/objstore
    replacement: github.com/grafana/objstore v0.0.0-20250210100727-533688b5600d
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      TODO: remove forks when changes are merged upstream — non-singleton cadvisor
    dependency: github.com/google/cadvisor
    replacement: github.com/grafana/cadvisor v0.0.0-20240729082359-1f04a91701e2
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      TODO: track exporter-package-v0.18.1 branch of grafana fork; remove once merged upstream
    dependency: github.com/prometheus-community/postgres_exporter
    replacement: github.com/grafana/postgres_exporter v0.0.0-20250930111128-c8f6a9f4d363
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      TODO: remove once PR is merged upstream: https://github.com/prometheus/mysqld_exporter/pull/774
    dependency: github.com/prometheus/mysqld_exporter
    replacement: github.com/grafana/mysqld_exporter v0.17.2-0.20250226152553-be612e3fdedd
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      TODO: replace node_exporter with custom fork for multi usage.
      https://github.com/prometheus/node_exporter/pull/2812
    dependency: github.com/prometheus/node_exporter
    replacement: github.com/grafana/node_exporter v0.18.1-grafana-r01.0.20251024135609-318b01780c89
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Use Grafana fork of smimesign
    dependency: github.com/github/smimesign
    replacement: github.com/grafana/smimesign v0.2.1-0.20220408144937-2a5adf3481d3
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Local submodule replace
    dependency: github.com/grafana/alloy/syntax
    replacement: ./syntax
    scope:
      - alloy

  - comment: Replace OpenTelemetry OBI with Grafana fork
    dependency: go.opentelemetry.io/obi
    replacement: github.com/grafana/opentelemetry-ebpf-instrumentation v1.3.7
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Replace OpenTelemetry eBPF profiler with Grafana fork
    dependency: go.opentelemetry.io/ebpf-profiler
    replacement: github.com/grafana/opentelemetry-ebpf-profiler v0.0.202546-0.20251106085643-a00a0ef2a84c
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      Update openshift/client-go to version compatible with structured-merge-diff v6
    dependency: github.com/openshift/client-go
    replacement: github.com/openshift/client-go v0.0.0-20251015124057-db0dee36e235
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      Use Grafana's patched k8sattributesprocessor with support for k8s.io/client-go v0.34.1
    dependency: github.com/open-telemetry/opentelemetry-collector-contrib/processor/k8sattributesprocessor
    replacement: github.com/grafana/opentelemetry-collector-contrib/processor/k8sattributesprocessor v0.0.0-20251021125353-73458b01ab23
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      Do not remove until bug in walqueue backwards compatibility is resolved:
      https://github.com/deneonet/benc/issues/13
    dependency: github.com/deneonet/benc
    replacement: github.com/deneonet/benc v1.1.7
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: >
      Pin runc to v1.2.8 for compatibility with cadvisor requiring libcontainer/cgroups packages
    dependency: github.com/opencontainers/runc
    replacement: github.com/opencontainers/runc v1.2.8
    scope:
      - alloy
      - collector
      - extension
      - syntax

  - comment: Replace controller-runtime with pinned version
    dependency: sigs.k8s.io/controller-runtime
    replacement: sigs.k8s.io/controller-runtime v0.20.4
    scope:
      - alloy
      - collector
      - extension
      - syntax